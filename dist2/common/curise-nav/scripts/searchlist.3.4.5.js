!function(){function e(e){var s=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(s);return null!=n?unescape(n[2]):null}function s(e){var s="";for(var n in e)s+=n+"="+e[n]+"&";return s.substring(0,s.length-1)}function n(e,s){if("object"==typeof e&&"object"==typeof s)for(var n in s)e[n]=s[n];return e}function t(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(e){var s,n,t,a,o,i,l,r="",h=0;for(e=_utf8_encode(e);h<e.length;)s=e.charCodeAt(h++),n=e.charCodeAt(h++),t=e.charCodeAt(h++),a=s>>2,o=(3&s)<<4|n>>4,i=(15&n)<<2|t>>6,l=63&t,isNaN(n)?i=l=64:isNaN(t)&&(l=64),r=r+_keyStr.charAt(a)+_keyStr.charAt(o)+_keyStr.charAt(i)+_keyStr.charAt(l);return r},this.decode=function(e){var s,n,t,a,o,i,l,r="",h=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<e.length;)a=_keyStr.indexOf(e.charAt(h++)),o=_keyStr.indexOf(e.charAt(h++)),i=_keyStr.indexOf(e.charAt(h++)),l=_keyStr.indexOf(e.charAt(h++)),s=a<<2|o>>4,n=(15&o)<<4|i>>2,t=(3&i)<<6|l,r+=String.fromCharCode(s),64!=i&&(r+=String.fromCharCode(n)),64!=l&&(r+=String.fromCharCode(t));return r=_utf8_decode(r)},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var s="",n=0;n<e.length;n++){var t=e.charCodeAt(n);128>t?s+=String.fromCharCode(t):t>127&&2048>t?(s+=String.fromCharCode(t>>6|192),s+=String.fromCharCode(63&t|128)):(s+=String.fromCharCode(t>>12|224),s+=String.fromCharCode(t>>6&63|128),s+=String.fromCharCode(63&t|128))}return s},_utf8_decode=function(e){for(var s="",n=0,t=c1=c2=0;n<e.length;)t=e.charCodeAt(n),128>t?(s+=String.fromCharCode(t),n++):t>191&&224>t?(c2=e.charCodeAt(n+1),s+=String.fromCharCode((31&t)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),s+=String.fromCharCode((15&t)<<12|(63&c2)<<6|63&c3),n+=3);return s}}function a(){var s="";return e("lid")?(s=e("lid"),fish.cookie.set({name:"cruiseSearchLid",value:s}),s):s=fish.cookie.get("cruiseSearchLid")?fish.cookie.get("cruiseSearchLid"):"75"}function o(){var e=fish.one(".hotSearch").width(),s=675-e-82-25;fish.one(".searchinput").css({width:s+"px;"})}function i(){var e=fish.trim(fish.one("#search").val()),s=fish.one("#search").attr("attr-value"),n=fish.one(".searchConditonLab").attr("data-lccity");if(lcCityIdStr=n?"&lc="+n:"",e==s||""==e)return location.href="/youlun/cruise-line-0-0-0-0-0-0-0-0-0-0.html"+lcCityIdStr,!1;var t=(new Date).getTime(),a=new Date("2016/05/21").getTime();return a>t&&"%E6%9C%89%E7%88%B1%E2%9D%A4%E5%87%BA%E5%8F%91"==encodeURIComponent(e)?(fish.one(".tehui i").removeClass("none"),fish.one(".tehui").attr("attr-chiose",1),void f()):1==fish.all(".autoComplete a.a_links").length?void(location.href=fish.one(".autoComplete a").attr("href")):void(location.href="/youlun/cruise-line-0-0-0-0-0-0-0-0-0-0.html&dest="+e+lcCityIdStr)}function l(e){this.ajaxObj&&this.ajaxObj.abort(),this.ajaxObj=fish.ajax({url:"/youlun/AjaxcallTravel.aspx?type=GetFuzzySearch&lid="+k+"&dest="+e+"&cityId="+fish.one(".searchConditonLab").attr("data-lccity"),type:"json",fn:function(s){var n="",t="",a="",o="",i="";if(s)if(0==s.FuzzySearchInfos.length)fish.one(".autoComplete").html("").addClass("none"),searchTrackEvent("/sbox/ac",{k:encodeURIComponent(fish.one("#search").val()),rc:0});else{for(var l=s.FuzzySearchInfos,h=0,c=l.length;c>h;h++){var d=new RegExp(decodeURIComponent(e),"g"),f=l[h].Name.replace(d,'<span class="c_fa7d29">$&</span>');switch(l[h].GroupType){case 0:t+='<a class="a_links" _showName="'+l[h].Name+'" href="'+l[h].Url+'">'+f+"</a>";break;case 1:a+='<a class="a_links" _showName="'+l[h].Name+'" href="'+l[h].Url+'">'+f+"</a>";break;case 2:o+='<a class="a_links" _showName="'+l[h].Name+'" href="'+l[h].Url+'">'+f+"</a>";break;default:i+='<a class="a_links" _showName="'+l[h].Name+'" href="'+l[h].Url+'">'+f+"</a>"}}t&&t.length>0&&(n+=' <div class="show_cons"><span class="tip_span">航线</span>'+t+"</div>"),a&&a.length>0&&(n+=' <div class="show_cons"><span class="tip_span">国家/城市</span>'+a+"</div>"),o&&o.length>0&&(n+=' <div class="show_cons"><span class="tip_span">邮轮公司/船队</span>'+o+"</div>"),i&&i.length>0&&(n+=' <div class="show_cons"><span class="tip_span">其他</span>'+i+"</div>"),fish.one(".autoComplete").html("").html(n),fish.all(".autoComplete a").on("click",function(){var e=fish.one(this).attr("href"),s=encodeURIComponent(fish.one(this).attr("_showName"));r(e,s)}),fish.all(".autoComplete a").each(function(e,s){this.index=s,fish.one(this).on("click",function(e){var s=this;fish.one(this);searchTrackEvent("/sbox/ac/click",{k:encodeURIComponent(fish.one("#search").val()),ct:encodeURIComponent(fish.one(this).attr("_showName")),pos:s.index+1,pjId:"2007",jpTp:1})})})}},err:function(){}})}function r(e,s){fish.ajax({url:"/youlun/AjaxcallTravel.aspx?type=SaveFuzzyClick&lid="+k+"&pageUrl="+e+"&staType=5&pageDis=1&remark="+s,type:"json",fn:function(){}})}function h(e){fish.all(".search_value").each(function(){fish.one(this).attr("typeid")==e&&fish.one(this).html("remove")})}function c(){fish.mPop({content:fish.one("#inline_example_load"),top:200})}function d(){var e=fish.one("#mobile").val()||"",s=fish.one("#criteoId1").val()||"",n=fish.one("#criteoId2").val()||"",t=fish.one("#criteoId3").val()||"";window.criteo_q=window.criteo_q||[],window.criteo_q.push({event:"setAccount",account:21750}),""!=e&&window.criteo_q.push({event:"setHashedEmail",email:e}),window.criteo_q.push({event:"setSiteType",type:"d"},{event:"viewList",item:[s,n,t]})}function f(){var e=fish.one(".searchConditonLab"),s=e.attr("data-producttypeid"),n=e.attr("data-hxid"),t=e.attr("data-hxcname"),a=e.attr("data-companyid"),o=e.attr("data-cruiseid"),i=e.attr("data-harbourid"),l=e.attr("data-dateid"),r=e.attr("data-daynumid"),h=e.attr("data-themeid"),f=e.attr("data-pctabid"),_=e.attr("data-holidayid"),v="0",C="0",g="0",b="0",y="0",k=fish.one("#baochuan").attr("attr-chiose"),w="0",j=fish.one(".tehui").attr("attr-chiose"),T="0",S="0",D="0",N="0",P="0",L="0",R="",B=fish.one(".pre_tc").attr("attr-chiose");lccityid=e.attr("data-lccity"),destWord=e.attr("data-dest")?"&dest="+encodeURIComponent(e.attr("data-dest")):"",lcCityIdStr=lccityid?"&lc="+lccityid:"";var A={};A.HxId=n,A.HxCid=t,A.CompanyId=a,A.CruiseId=o,A.HarbourId=i,A.DateId=l,A.DayNum=r,A={SearchCondition:encodeURIComponent(JSON.stringify(A))};var M=fish.one("#bqContent").attr("attr-url");fish.all(".cond_tab_filterbox a").each(function(){if(fish.one(this).hasClass("active")){var e=fish.one(this).html();e.indexOf("综合排序")>=0?v="1":e.indexOf("满意度")>=0?C="2":e.indexOf("价格")>=0?g=0==fish.one(this).attr("price_info")?"2":"1":e.indexOf("航期")>=0&&(y=0==fish.one(this).attr("date_info")?"2":"1")}}),R=k+w+j+T+S+D+N+P+L,R=parseInt(R,2),M+="&producttypeid="+s+"&hxid="+n+"&hxcid="+t+"&companyid="+a+"&cruiseid="+o+"&harbourid="+i+"&dateid="+l+"&sortManyiType="+C+"&sortPriceType="+g+"&sortCmCountType="+b+"&sortSailDateType="+y+"&dayNum="+r+"&themeId="+h+"&pctabid="+f+"&tagNum="+R+"&isTCSpecialLine="+B+"&holidayId="+_+"&dest="+encodeURIComponent(x)+"&lccityid="+lccityid,fish.all("#pageCountent").mPage({startWithAjax:!0,pageNO:"pageNum",beforeAjaxFn:function(){""!=fish.trim(fish.one("#bqContent").html())&&c()},callback:function(e,c){function f(){for(var e=O.year,l=O.holidayObj,c="<div class='rqsliderCon'><span class='sliderBtn prevBtn prevBtnN none'></span><span class='sliderBtn nextBtn none'></span><div class='rqslider' attr-left='0'>",d=["1月|01","2月|02","3月|03","4月|04","5月|05","6月|06","7月|07","8月|08","9月|09","10月|10","11月|11","12月|12"],f=0,u=e.length;u>f;f++){for(var p='<div class="year_sty"><h4 class="year_tit">'+e[f]+"年</h4>{{month}}</div>",m="",_=0,v=d.length;v>_;_++){var C=d[_].split("|");m+='<a class="link_sty linksty link_none" href="/youlun/cruise-line-'+n+"-"+a+"-0-"+e[f]+C[1]+"-"+i+"-"+t+"-"+h+"-"+r+"-"+o+"-"+s+"-0.html"+destWord+lcCityIdStr+'" _dValue="'+e[f]+C[1]+'" inputValue="'+e[f]+"年"+C[1]+'月">'+C[0]+"</a>"}if(l[e[f]])for(var g=0,b=l[e[f]].length;b>g;g++){var y=l[e[f]][g];m+="<a class='link_sty linksty"+(parseInt(y.Id)>0?" ":" link_none")+"' href='/youlun/cruise-line-"+n+"-"+a+"-0-0-"+i+"-"+t+"-"+h+"-"+r+"-"+o+"-"+s+"-"+y.Id+".html"+destWord+lcCityIdStr+"'>"+y.Name+"</a>"}p=p.replace("{{month}}",m),c+=p}return c+="</div></div>"}if(e){if(e.LineMessageMod){for(var _=0,v=0,C=[],g=0,b=e.LineMessageMod.length;b>g;g++)e.LineMessageMod[g].IsTCRecommend&&1==e.LineMessageMod[g].IsTCRecommend&&(_++,C.push(e.LineMessageMod[g].LineId));window.isRunDSP||(window.isRunDSP=!0,dsp&&dsp(C.join(","))),C=[],v=e.TotalLineCount-_,v=v&&v>0?v:0,window.showTrackEvent?c>1&&searchTrackEvent("/page",{k:encodeURIComponent(fish.one(".searchConditonLab").attr("data-dest")),page:c}):(window.showTrackEvent=!0,searchTrackEvent("/show",{k:encodeURIComponent(x),rc:v})),trackEventUseCookie({lable:"/sbox/k",type:2,value:{k:encodeURIComponent(fish.one(".searchConditonLab").attr("data-dest")),rc:v}}),trackEventUseCookie({type:2,lable:"/filter",value:{k:encodeURIComponent(fish.one(".searchConditonLab").attr("data-dest")),rc:fish.one(".cond_tab_filterbox .tehui").attr("attr-chiose")-0==1?e.YouhuiCount:v}})}fish.one("#bqContent").css("margin:0;width:auto;height:auto;background:none;");var y="",k=e.CruiseSearchStartCityContinent,w=e.SailDateByYearMod,j=e.TotalPageNum,T=[];""==fish.one("#stateName").html()&&(y='{{for(var i = 0,j = it.length;i < j; i++){ }}                                        <a class="stateName{{? i == 0}} stateNameAt{{?}}">{{=it[i].ContinentName}}</a>                                    {{}}}                                    <div class="data_pop" id="cityType">                                        {{for(var i = 0,j = it.length;i < j; i++){ }}                                            <div class="data_main {{? i != 0}}none{{?}}">                                                {{for(var n = 0,m = it[i].StartCities.length;n < m; n++){ }}                                                    <a title="{{=it[i].StartCities[n].CityName}}" href="/youlun/cruise-line-'+n+"-"+a+"-0-"+l+"-{{=it[i].StartCities[n].CityId}}-"+t+"-"+h+"-"+r+"-"+o+"-"+s+".html"+destWord+lcCityIdStr+'">{{=it[i].StartCities[n].CityName}}</a>                                                {{}}}                                            </div>                                        {{}}}                                    </div>                                    ',fish.one("#stateName").html(fish.template(y,k))),O.year=[],O.holidayObj=[];for(var g=0,S=w.length;S>g;g++){var D={};O.year.push(w[g].Year);for(var N=0,P=w[g].Pm.length;P>N;N++)T.push(w[g].Pm[N].Value);w[g]&&w[g].HolidayList&&w[g].HolidayList[0]&&(D[w[g].Year]=w[g].HolidayList,fish.lang.extend(O.holidayObj,D))}if(""==fish.one(".scut_sty_main").html()&&(fish.one(".scut_sty_main").html(f()),1==fish.all(".year_sty").length?fish.one(".calendar_box .scut_sty .scut_sty_main").css("width:195px;"):fish.one(".calendar_box .scut_sty .scut_sty_main").css("width:391px;"),m(),fish.all(".calendar_box .scut_sty a").each(function(e,s){for(var n=fish.all(".calendar_box .scut_sty a"),t=fish.one(n[s]).attr("_dvalue"),a=0,o=T.length;o>a;a++)t==T[a]&&fish.one(n[s]).removeClass("link_none")}),fish.all(".link_none").attr("href","javascript:void(0);")),fish.dom("body").onclick=function(e){var s=fish.getTarget(e),n=s.className,t=s.parentNode,a=fish.one(s).getParent(".hotCity"),o=fish.one(s).getParent(".history"),i=fish.one(s).getParent(".autoComplete");if(n.indexOf("pack_hx")>-1||n.indexOf("pack_cd")>-1||n.indexOf("pack_ej")>-1||n.indexOf("pack_hs")>-1?(fish.one(s).hasClass("pack_down")?(fish.one(s).removeClass("pack_down").html("收起<em></em>"),fish.one("dd",t).removeClass("hidden_dd")):(fish.one(s).addClass("pack_down").html("更多<em></em>"),fish.one("dd",t).addClass("hidden_dd")),fish.one(".calendar_box .scut_sty").addClass("none"),fish.one(".moremonth").removeClass("more")):n.indexOf("pack_cs")>-1?(fish.one(s).hasClass("pack_down")?(fish.one(s).removeClass("pack_down").html("收起<em></em>"),fish.one("dd",t).removeClass("hidden_dd"),fish.all(".stateName").length>1&&(fish.one("#cityName").addClass("none"),fish.one("#stateName").removeClass("none"))):(fish.one(s).addClass("pack_down").html("更多<em></em>"),fish.one("dd",t).addClass("hidden_dd"),fish.one("#cityName").removeClass("none"),fish.one("#stateName").addClass("none")),fish.one(".calendar_box .scut_sty").addClass("none"),fish.one(".moremonth").removeClass("more")):n.indexOf("calendar_box")>-1||n.indexOf("moremonth")>-1||n.indexOf("year_tit")>-1||n.indexOf("year_sty")>-1||n.indexOf("sliderBtn")>-1||n.indexOf("link_none")>-1?(fish.one(".calendar_box .scut_sty").removeClass("none"),fish.one(".moremonth").addClass("more")):(fish.one(".calendar_box .scut_sty").addClass("none"),fish.one(".moremonth").removeClass("more")),n.indexOf("autoComplete")>-1||i.length>0?fish.one(".autoComplete").removeClass("none"):fish.one(".autoComplete").addClass("none"),n.indexOf("hotCity")>-1||a.length>0?(fish.one(".hotCity ").removeClass("none"),o.length>0&&"A"==s.tagName.toUpperCase()&&(fish.one(".hotCity ").addClass("none"),fish.one(".autoComplete").removeClass("none"))):fish.one(".hotCity ").addClass("none"),n.indexOf("searchinput")>-1){var l=fish.trim(fish.one("#search").val()),r=fish.one("#search").attr("attr-value");l==r||""==l?(fish.one("#search").val(""),fish.one(".hotCity").removeClass("none"),fish.one(".autoComplete").addClass("none")):(fish.one(".hotCity").addClass("none"),fish.one(".autoComplete").removeClass("none"))}},fish.one("body").on("mouseover",function(e){var s=fish.getTarget(e),n=s.className,t=s.parentNode;n.indexOf("ts_x")>-1?(fish.one(s).removeClass("pack_down"),fish.one("#dayType").removeClass("none"),fish.one(".pack_lx").addClass("pack_down"),fish.one("#productType").addClass("none")):n.indexOf("lx_x")>-1?(fish.one(s).removeClass("pack_down"),fish.one("#productType").removeClass("none"),fish.all("#productType a").length<2,fish.one(".pack_ts").addClass("pack_down"),fish.one("#dayType").addClass("none")):n.indexOf("data_pop")>-1||n.indexOf("data_top")>-1||n.indexOf("data_main")>-1||t.className.indexOf("data_main")>-1?"dayType"==s.id?(fish.one(s).removeClass("pack_down"),fish.one("#dayType").removeClass("none")):"productType"==s.id&&(fish.one(s).removeClass("pack_down"),fish.one("#productType").removeClass("none")):(fish.all(".pack_ts,.pack_lx").addClass("pack_down"),fish.all("#dayType,#productType").addClass("none"))}),fish.all(".stateName").each(function(e,s){fish.one(this).on("click",function(){var e=fish.all(".stateName"),n=fish.all("#stateName .data_main");e.removeClass("stateNameAt"),n.addClass("none"),fish.one(e[s]).addClass("stateNameAt"),fish.one(n[s]).removeClass("none")})}),""!=fish.trim(fish.one("#bqContent").html())){var L=fish.one(".mainLeft").offset().top;window.scrollTo(0,L),fish.require("mPop",function(){fish.mPop.close()})}if(e&&e.LineMessageMod&&e.LineMessageMod.length>0){var R=u(e);fish.one("#bqContent").html(R),fish.all(".line_info .icon_bc").hover(function(){fish.one(".bc_tcW",fish.one(this)).removeClass("none")},function(){fish.one(".bc_tcW",fish.one(this)).addClass("none")}),I(fish.all("#bqContent .line_info .tit a"),D),I(fish.all("#bqContent .line_info .yhmore"),D),I(fish.all("#bqContent .line_info .linebtn"),D),fish.all(".map img").on("mouseover",function(){var e=fish.one(this).offset(),s=e.top,n=e.left,t=fish.one(this).width(),a=fish.one(this).attr("src");a.indexOf("gif")<0&&(fish.one("#Popview1").removeClass("none").css("top:"+s+"px;left:"+(t+n+10)+"px;"),fish.one("#Popview1 img").attr("src",a))}).on("mouseout",function(){fish.one("#Popview1").addClass("none")}),fish.one(".myline em").html(e.TotalLineCount+"条"),fish.one(".tehui").removeClass("none"),0==e.YouhuiCount?fish.one(".tehui").addClass("none"):fish.one(".tehui .txt").html(e.YouhuiCount+"条"),d(),fish.all(".rsConList .map img").lazyLoad({attr:"data-nsrc",preSpace:100});var B=fish.cookie.get("searchHistory"),A="";if(x){if(B)if(B.indexOf("||")>-1){var T=B.split("||"),M=T.length;M>=10&&(M=9),A+=x;for(var g=0;M>g;g++)if(A+="||"+T[g],T[g]==x)return}else B!=x&&(A+=x+"||"+B);else A=x;A&&(fish.cookie.set({name:"searchHistory",value:A,path:"/youlun"}),p())}}else if(e.LineMessageMod&&0==e.LineMessageMod.length){fish.one(".myline em").html("0条");var U='<div class="norsBox">											<div class="norsShow"><span class="norsTit">很抱歉，没有找到“'+x+'”相关的航线，您可以尝试其他关键词进行搜索或者<br/>您也可以<a class="ylc-custom" title="" href="http://livechat.ly.com/out/guest?p=6&amp;c=0&amp;pageId=6001&amp;lineId=0&amp;robsid=13162532" target="_blank">联系我们的客服</a>，帮您挑选和预订产品</span></div>											<div class="love"><p>您可能感兴趣的航线</p></div>';fish.ajax({url:"/youlun/AjaxcallTravel.aspx?Type=GetSearchRecLine&hxid="+n+"&pageNum=1",type:"json",fn:function(e){U+=u(e)+"</div>",fish.one("#bqContent").html(U),I(fish.all("#bqContent .line_info .tit a"),D),I(fish.all("#bqContent .line_info .yhmore"),D),I(fish.all("#bqContent .line_info .linebtn"),D)}})}0==j?fish.one("#pageCountent").addClass("none"):fish.one("#pageCountent").removeClass("none")}},preSortTotal:function(e){return e.TotalPageNum},ajaxObj:{type:"json",url:M,fn:function(e){return e}},skip:"true"})}function u(e){function s(e){var s=r[e];return s?'<span class="label_d"><span class="layer"></span><span class="p_text"><em>'+s+"</em></span></span>":""}function n(e){return'<span class="label_d"><span class="layer"></span><span class="p_text"><em>'+e+"</em></span></span>"}for(var t="",a="",o="",i=fish.all("#bqContent .line_info").length,l=fish.trim(fish.one(".searchbox .curr").html()),r=e.TagDesc,h=0,c=e.LineMessageMod.length;c>h;h++){var d=e.LineMessageMod[h],f=d.LineId,u=d.IshasRefid,p=d.MainTitle,m=d.SubTitle,_=d.IsTicket,v=d.IsGuoJi,C=d.IsTCRecommend,g=d.IsTCSpecialLine,b=d.IsBaoChuan,y=d.IntroImagePro,k=d.TagListModel.TagList,x=d.SailDateListModel.SailDateList,w=d.GoodSatisfacstr,j=d.Satisfacstr,T=d.TravelSimpIntro,I=d.CruiseName,S=(d.IsUseRed,d.Prize),D=d.IsPromtion,O=d.PromotionTitle,N=d.PackageCount,P=d.OnPtName,L=d.DownPtName,R=d.DepartureCity,B="/youlun/tours-"+f+".html",A="",M="",U="",q="",E="",F="",H="",z="",$="",G=d.IsBlankNote,W=d.BlankNote,Y=d.BlankNoteFree;0==u?B:B+="#refid="+u;var K=(new Date).getTime(),V=new Date("2016/05/21").getTime(),J=new Date("2016/05/25").getTime(),Z=new Date("2016/06/20").getTime(),Q="";1==D&&K>=J&&Z>K&&(A+='<span class="hot616"></span>');var X="同程旅游联合境内外优质供应商为用户甄选提供更专业更高品质的产品。";1==g?A+='<span class="tczx">同程专线'+n(X)+"</span>":A;var ee='<span class="bc_tcW none"><span class="arr_top"></span><span class="bc_tcM"><em class="p_text">码头接送，方便贴心<br/>专属客服，热情专业<br/>主题活动，独家特色<br/>精选领队，服务周到</em></span></span>',se=1==b?'<span class="icon_bc">'+ee+"</span>":"";if(k&&k.length>0)for(var ne=0;ne<k.length;ne++)A+="<span>"+k[ne]+s(k[ne])+"</span>";if(1==G){var te=Y>0?"，免息"+Y+"期":"",ae="可分"+W+"期支付"+te+"，出游更超值！";A+="<span>分期付款"+n(ae)+"</span>"}var oe="“定格幸福，有爱就购了” 5月20日当天，在同程全平台，下单并当天支付的用户享受双人房型立返￥200/人";if(V>K&&(A+='<span class="th520">520特惠'+n(oe)+"</span>"),z="_tcTraObj._tcTrackEvent('zxyl_2','pc邮轮列表', 'pc邮轮列表页点击线路', '^listview^"+l+"^"+(i+h+1)+"^"+I+"^"+f+"^"+g+"^');",x&&x.length>0){var ie=x.length;if(ie>3){for(var le=0;3>le;le++)M+="<em>"+x[le]+"</em>";M+='<span class="more up" _attr-id="'+f+'">更多<i></i></span>'}else for(var le=0;ie>le;le++)M+="<em>"+x[le]+"</em>"}j&&j>0&&(F='<span class="dp_count"><em>'+j+"条</em>点评</span>"),w&&w>0&&(H='<span class="good"><em>'+w+"%</em>满意</span>"),N>0?E='<em class="lb">礼包</em>':E,E+=1==D&&O?'<span><em class="yh">优惠</em>'+O+'</span><a class="yhmore" href="'+B+'" onclick="'+z+'" target="_blank">更多优惠>></a>':'<em class="tese">特色</em>'+m,1==_&&2==v?(E="",q+='<p class="date">上船港口：<em class="dowm">'+P+"</em>下船港口：<em>"+L+"</em></p>"):E='<p class="tip">'+E+"</p>",A.length&&(A="<p class='label'> "+A+"</p>"),T&&(U='<p class="plans">行程概况：<em title="'+T+'">'+T+"</em></p>"),$='<div class="line_info" _asIndex="'+(i+h+1)+'" _lineId="'+f+'">                                        <div class="info_l">                                            <div class="map">                                                '+Q+'<img src="'+y+'" alt="'+p+'">                                                <p>'+I+'</p>                                            </div>                                        </div>                                        <div class="info_r">                                            <div class="info_cont">                                                <div class="tit">                                                    <a href="'+B+'" onclick="'+z+'" title="'+p+'" target="_blank">'+p+"</a> "+se+"                                                </div>                                                "+A+"                                                "+U+"                                                "+E+"                                                "+q+'                                                <p class="date"><span class="locationcity">'+R+"出发</span>出发日期：                                                    "+M+'                                                </p>                                                <div class="info_right">                                                    <span class="lineprice"><strong>&yen;<em>'+S+'</em></strong>起</span>                                                    <a class="linebtn" href="'+B+'" onclick="'+z+'" target="_blank">查看详情</a>                                                    <p class="review">                                                        '+F+"                                                        "+H+'                                                    </p>                                                </div>                                            </div>                                        </div>                                    <div class="calendar none"></div>                                <div class="clearfix"></div></div>',1==C?o+=$:a+=$}return t='<div class="rsConList recommed">'+o+'</div>                   <div class="rsConList">'+a+"</div>"}function p(){var e=fish.cookie.get("searchHistory"),s="";if(e){if(e.indexOf("||")>-1)for(var n=e.split("||"),t=0;t<n.length;t++)s+="<a>"+n[t]+"</a>";else s+="<a>"+e+"</a>";fish.all(".history a").html("remove"),fish.one(".history").removeClass("none").html("bottom",s)}else fish.one(".history").addClass("none");fish.one(".clearHistory").on("click",function(){fish.cookie.set({name:"searchHistory",value:"",path:"/youlun"}),fish.one(".history").addClass("none")}),fish.all(".history a").on("click",function(){var e=fish.one(this).html();fish.one(".searchinput").val(e).css("color:#333;"),fish.one(".autoComplete").removeClass("none"),l(encodeURIComponent(e))}),fish.all(".history a").each(function(e,s){this.index=s,fish.one(e).on("click",function(e){var s=fish.one(this);searchTrackEvent("/sbox/k/history",{k:encodeURIComponent(s.html()),pos:this.index+1,jpTp:1})})})}function m(){var e=fish.all(".calendar_box .scut_sty .year_sty").length,s=196*e,n=s-392;fish.one(".rqslider").css("width:"+s+"px;"),e>2&&fish.all(".sliderBtn").removeClass("none"),fish.all(".sliderBtn").on("click",function(){var e=fish.one(this),s=parseInt(fish.one(".rqslider").attr("attr-left"),10);fish.all(".sliderBtn").removeClass("prevBtnN").removeClass("nextBtnN"),e.hasClass("prevBtnN")||e.hasClass("nextBtnN")||(e.hasClass("prevBtn")?(s=0>=s-196?0:s-196,fish.one(".rqslider").attr("attr-left",s).anim("left:"+-s+"px;",500),0==s?fish.one(".prevBtn").addClass("prevBtnN"):fish.one(".prevBtn").removeClass("prevBtnN")):e.hasClass("nextBtn")&&(s=s+196>=n?n:s+196,fish.one(".rqslider").attr("attr-left",s).anim("left:"+-s+"px;",500),s==n?fish.one(".nextBtn").addClass("nextBtnN"):fish.one(".nextBtn").removeClass("nextBtnN")))})}function _(e,s){fish.ajax({url:"/youlun/CruiseTours/CruiseToursAjax_book.aspx?Type=GetToursDataList&lineid="+s,data:"IsSearchPromotion=1",type:"json",sync:!0,fn:function(s){v(e,s)}})}function v(e,s){var n=fish.one(".calendar",e.parent(".line_info")),t=fish.one("a",e.parent(".line_info")).attr("href");fish.require("Calendar",function(){var e=fish.parseDate(s[0].LineDate),a=fish.parseDate(s[s.length-1].LineDate),o=e.getFullYear(),i=e.getMonth()+1,l=e.getDate(),r=a.getFullYear(),h=a.getMonth()+1,c=a.getDate(),d=o+"-"+i+"-"+l,f=r+"-"+h+"-"+c,u=new fish.Calendar({monthNum:2,wrapper:n,style:"show",startDate:d,endDate:f,mode:"rangeFrom",currentDate:[d,f],buildContent:function(e,n,a){O.build(e,n,a,s,t)}});u.pick({startDate:d,endDate:f,mode:"rangeFrom",currentDate:[d,f],buildContent:function(e,n,a){O.build(e,n,a,s,t)}})})}function C(){var e=fish.one("#cruiseid").val(),s=window.location.href,n="/youlun"+s.split("/youlun")[1];fish.ajax({url:"/youlun/AjaxCall_Cruise.aspx?Type=CruiseStrategyStatistic&Url="+n+"&pagetype=AdvancedSearchPage&cruiseid="+e,type:"json",fn:function(e){}})}function g(e){return/^1[3,4,5,7,8]\d{9}$/i.test(e)}function b(){if(y("2016/06/02 00:00:00","2016/06/20 00:00:00")){fish.one(".workendactive").removeClass("none");var e=localStorage.lastOpenTime||0;0==e||e!=fish.parseDate()?(localStorage.lastOpenTime=fish.parseDate(),fish.one(".bonus_box").css({left:0}),fish.one(".aside_tag").css({left:"-136px;"})):(fish.one(".bonus_box").css({left:"-100%;"}),fish.one(".aside_tag").css({left:0}))}y("2016/06/02 00:00:00","2016/06/09 00:00:00")&&(fish.one(".searchSale").attr("href","http://www.ly.com/zhuanti/youlundashiji"),fish.one(".searchSale img").attr("src","http://img1.40017.cn/cn/y/16/h/3.0.3/dashijian.gif")),fish.one(".bonus_form a").on("click",function(){if(!fish.one(this).hasClass("getting")){var e=fish.trim(fish.one(".phone").val()),s=fish.trim(fish.one(".code").val());if(!g(e))return void fish.one(".bonus_tip").html("<span>亲，请输入正确手机号</span>").removeClass("none");if(""==s)return void fish.one(".bonus_tip").html("<span>亲，请输入正确验证码</span>").removeClass("none");fish.one(this).addClass("getting"),fish.ajax({url:"/youlun/CruiseRedPacket/CruiseRedPacketajax.aspx?type=GetGiftPacketByMobile&mobile="+e+"&checkCode="+s,type:"json",fn:function(e){var s="/youlun/CruiseRedPacket/CruiseRedPacketajax.aspx";return fish.one(".bonus_form img").attr("src",s+"?type=GetRedPackCheckCode&module=1&height=40&width=60&r="+Math.random()),5==e.ResultCode?(fish.one(".bonus_tip").html("<span>亲，请输入正确验证码</span>").removeClass("none"),fish.one(".code").val(""),void fish.one(".bonus_form a").removeClass("getting")):void(0==e.ResultCode?(fish.all(".bonus_bg,.bonus_box").addClass("none"),fish.all(".bonus_mask,.bonus_suc").removeClass("none"),fish.one(".bonus_form a").removeClass("getting")):3==e.ResultCode&&(fish.all(".bonus_bg,.bonus_box").addClass("none"),fish.all(".bonus_mask,.bonus_suc").removeClass("none"),fish.one(".bonus_suc img").attr("src","http://img1.40017.cn/cn/y/15/h/hb2.jpg?v=1"),fish.one(".bonus_form a").removeClass("getting")))}})}}),fish.all(".phone,.code").on("focus",function(){fish.one(".bonus_tip").addClass("none")}),fish.one(".bonus_form img").on("click",function(){fish.one(".code").val("");var e="/youlun/CruiseRedPacket/CruiseRedPacketajax.aspx";fish.one(".bonus_form img").attr("src",e+"?type=GetRedPackCheckCode&module=1&height=40&width=60&r="+Math.random())}),fish.all(".bonus_suc .close,.use").on("click",function(){fish.all(".bonus_bg,.bonus_box").anim("left:-100%",800,function(){fish.one(".aside_tag").anim("left:0px;",200)}),fish.all(".bonus_mask,.bonus_suc").addClass("none")}),fish.one(".bonus_box .close").on("click",function(){fish.all(".bonus_bg,.bonus_box").anim("left:-100%",800,function(){fish.all(".bonus_bg,.bonus_box").addClass("none"),fish.one(".aside_tag").anim("left:0px;",200)})}),fish.one(".aside_tag").on("click",function(){var e=fish.one(this).width();fish.one(".aside_tag").anim("left:-"+e+"px;",200,function(){fish.all(".bonus_bg,.bonus_box").removeClass("none").anim("left:0%",800)})}),fish.browser("ms")&&fish.all(".bonus_box input").each(function(){var e=fish.one(this).attr("placeholder");fish.one(this).val(e).css({color:"#666"}).on("focus",function(){fish.one(this).val()==e&&fish.one(this).val("")}).on("blur",function(){""==!fish.one(this).val()?fish.one(this).css({color:"#333"}):fish.one(this).val(e)})})}function y(e,s){var n=new Date,t=new Date(e),a=new Date(s),o=n.getTime(),e=t.getTime(),s=a.getTime();return o>e&&s>o}fish.admin.config({Calendar:{v:"0.3",css:1,g:20140333106},mPage:{v:"0.5.4",g:20130111,css:1}});var k=a(),x=fish.one(".searchConditonLab").attr("data-dest"),w={},j=0;String.prototype.getLineId=function(){return this.split("-")[1].split(".")[0]},String.prototype.addParams=function(e){var s=this,n="";if("object"==typeof e)for(var t in e)e[t]&&(n+="&"+t+"="+e[t]);return n&&(s+=s.indexOf("?")>-1?n:"?"+n.substring(1,n.length)),s};var T=function(){if(!(j>0)){var e=fish.one(".searchConditonLab"),a={},o=new t;a.HxId=e.attr("data-hxid"),a.HxCid=e.attr("data-hxcname"),a.CompanyId=e.attr("data-companyid"),a.CruiseId=e.attr("data-cruiseid"),a.HarbourId=e.attr("data-harbourid"),a.DateId=e.attr("data-dateid"),a.DayNum=e.attr("data-daynumid"),w=a={SearchCondition:o.encode(encodeURIComponent(JSON.stringify(a)))};var i={PageType:"AdvancedSearchPage",Userid:"undefined"==typeof getMemberId?0:getMemberId(),Lid:k,Url:encodeURIComponent(location.href),v:(new Date).getTime()};i=n(i,a),fish.ajax({url:"/youlun/AjaxCall_Cruise.aspx?Type=CruiseSpecialStatistic",data:s(i),openType:"post",fn:function(){j++}})}},I=function(e){var s=e,n=s.length;if(!(1>n)){for(var t=[],a=[],o="",i=0;n>i;i++){var l=s[i].getAttribute("href")?s[i].getAttribute("href").getLineId():"";t.push(l),a.push({ind:i,lid:l})}o=t.join(",");var r=w;fish.ajax({url:"/youlun/AjaxCall_Cruise.aspx?Type=GenerateSpecialStatisticKey",data:"LineIds="+o+"&lid="+k+"&v="+(new Date).getTime(),type:"json",timeout:8e3,fn:function(e){if(e&&e.length>0)for(var n=0,t=e.length;t>n;n++)for(var o=0,i=a.length;i>o;o++)if(a[o].lid==e[n].LineId&&e[n].Key){var l=s[a[o].ind].getAttribute("href");if(s[a[o].ind].getAttribute("href").indexOf("Key")>-1)continue;var h=l.addParams({Key:e[n].Key}).addParams(r);s[a[o].ind].setAttribute("href",h)}},err:function(){},onTimeout:function(){}})}};window.bindLid=function(e){if(e&&e.length)for(var s=0,n=e.length;n>s;s++){var t=e[s],a=t.getAttribute("href");if(a){var o=a.addParams({lid:k});t.setAttribute("href",o)}}},fish.ready(function(){var e=fish.one(".searchConditonLab"),s=e.attr("data-tcspeicalflag");e&&1==e.length&&s&&"1"==s&&(fish.one(".pre_tc i").removeClass("none"),fish.one(".pre_tc").attr("attr-chiose",1)),f(),T(),b()}),fish.one(".top_link").on("click",function(){window.scrollTo(0,0)}),window.onscroll=function(){var e=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop,s=fish.one(".cond_tab"),n=s.offset().top;fish.one(".box_tab");e>n?(fish.one(".cond_tab_filterbox").css({position:"fixed",top:0,"z-index":10}),fish.one(".box_tab").css({position:"fixed",top:0,"z-index":10})):(fish.one(".cond_tab_filterbox").css({position:""}),fish.one(".box_tab").css({position:""})),fish.one(window).scrollTop()>50?fish.one(".top_link").removeClass("none"):fish.one(".top_link").addClass("none")},fish.one(".wx_link").on("mouseover",function(){fish.one(".app_fix").removeClass("none")}).on("mouseout",function(){fish.one(".app_fix").addClass("none")}),fish.one(".back").mFix({showType:"top",bottom:150,right:50});var S=(new Date).getTime(),D=new Date("2016/05/21").getTime();D>S?fish.one("#search").val("有爱❤出发").css("color:#333"):""==x&&fish.one("#search").val(fish.one("#search").attr("attr-value")),o(),fish.one("#search").on("blur",function(){var e=fish.trim(fish.one(this).val()),s=fish.one(this).attr("attr-value");""==e?fish.one(this).val(s).css("color:#999;"):fish.one(this).css("color:#333;")}).on("keyup",function(e){var s=fish.getEvent(e),n=s.keyCode?s.keyCode:e.which;13==n&&(i(),trackEventUseCookie({lable:"/sbox/k"}));var t=this.value,a=new RegExp("[/\\~!@#$%^&*_={}[];:'\"|,.<>?！￥……——｛｝【】；：‘“’”、《》，。、？]","g");this.value=t.replace(a,"");var o=encodeURIComponent(this.value);""==o?(fish.one(this).css("color:#999;"),fish.one(".hotCity").removeClass("none"),fish.one(".autoComplete").addClass("none")):(fish.one(".hotCity").addClass("none"),fish.one(this).css("color:#333;"),fish.one(".autoComplete").removeClass("none"),
l(o))}),fish.one(".toSearch").on("click",function(){trackEventUseCookie({lable:"/sbox/k"}),i()}),fish.all(".hotword a").on("click",function(){var e=fish.one(this).attr("href"),s=encodeURIComponent(fish.one(this).html());r(e,s)}),fish.all(".cond_tab_conbox dl").each(function(){"hxid"==fish.one(this).attr("attr-param")&&(fish.one(this).height()>41?(fish.one(".pack_up",this).css("display:block").html("更多<em></em>"),fish.one(".pack_up",this).addClass("pack_down"),fish.one("dd",this).addClass("hidden_dd")):fish.one(".pack_up",this).css("display:none")),"companyid"==fish.one(this).attr("attr-param")&&(fish.one(this).height()>41?(fish.one(".pack_up",this).css("display:block").html("更多<em></em>"),fish.one(".pack_up",this).addClass("pack_down"),fish.one("dd",this).addClass("hidden_dd")):fish.one(".pack_up",this).css("display:none")),"cruiseid"==fish.one(this).attr("attr-param")&&(fish.one(this).height()>41?(fish.one(".pack_up",this).css("display:block").html("更多<em></em>"),fish.one(".pack_up",this).addClass("pack_down"),fish.one("dd",this).addClass("hidden_dd")):fish.one(".pack_up",this).css("display:none")),"harbourid"==fish.one(this).attr("attr-param")&&(fish.one(this).height()>41?(fish.one(".pack_up",this).css("display:block").html("更多<em></em>"),fish.one(".pack_up",this).addClass("pack_down"),fish.one("dd",this).addClass("hidden_dd")):fish.one(".pack_up",this).css("display:none")),"dateid"==fish.one(this).attr("attr-param")&&(fish.one(this).height()>41?(fish.one(".pack_up",this).css("display:block").html("更多<em></em>"),fish.one(".pack_up",this).addClass("pack_down"),fish.one("dd",this).addClass("hidden_dd")):fish.one(".pack_up",this).css("display:none"))}),fish.all(".cond_tab_conbox a").on("click",function(){if(!fish.one(this).hasClass("on")){var e=fish.dom(this).parentNode,s=fish.dom(e).parentNode,n=(fish.one(this).attr("id"),fish.one(s).attr("attr-param")),t=(fish.one("dt",s).html(),fish.one(this).attr("title"));fish.all("a",e).removeClass("on"),fish.one(this).addClass("on"),h("全部"==t?n:n)}}),fish.all(".a_chioce").on("click",function(e){if(searchTrackEvent("/sort",{k:encodeURIComponent(fish.one(".searchConditonLab").attr("data-dest"))}),fish.one(this).hasClass("rank")||!fish.one(this).hasClass("active")){var s=fish.getTarget(e),n=s.className;n&&n.indexOf("salessort")>-1?(fish.all(".a_chioce").removeClass("active"),fish.one(".salesPrice").addClass("active"),"价格从低到高"==s.innerHTML?(fish.one(".salesPrice").attr("price_info",1),fish.one(".salesPrice font").html("价格从低到高")):(fish.one(".salesPrice").attr("price_info",0),fish.one(".salesPrice font").html("价格从高到低")),fish.one(".comment").html("满意度"),fish.one(".dates").attr("price_info",1),fish.one(".dates font").html("航期<i></i>"),f()):n&&n.indexOf("comment")>-1?(fish.all(".a_chioce").removeClass("active"),fish.one(".comment").addClass("active").html("满意度从高到低"),fish.one(".salesPrice").attr("price_info",0),fish.one(".salesPrice font").html("价格<i></i>"),fish.one(".dates").attr("price_info",1),fish.one(".dates font").html("航期<i></i>"),f()):n&&n.indexOf("datessort")>-1?(fish.all(".a_chioce").removeClass("active"),fish.one(".dates").addClass("active"),"航期从近到远"==s.innerHTML?(fish.one(".dates").attr("date_info",0),fish.one(".dates font").html("航期从近到远")):(fish.one(".dates").attr("date_info",1),fish.one(".dates font").html("航期从远到近")),fish.one(".comment").html("满意度"),fish.one(".salesPrice").attr("price_info",0),fish.one(".salesPrice font").html("价格<i></i>"),f()):n&&n.indexOf("all")>-1&&(fish.all(".a_chioce").removeClass("active"),fish.one(".all").addClass("active"),fish.one(".comment").html("满意度"),fish.one(".salesPrice").attr("price_info",0),fish.one(".salesPrice font").html("价格<i></i>"),fish.one(".dates").attr("price_info",1),fish.one(".dates font").html("航期<i></i>"),f())}}).on("mouseover",function(){fish.one("ul",this).removeClass("none")}).on("mouseout",function(){fish.one("ul",this).addClass("none")}),fish.one(".pre_tc").on("click",function(){fish.one("i",this).hasClass("none")?(fish.one("i",this).removeClass("none"),fish.one(this).attr("attr-chiose",1)):(fish.one("i",this).addClass("none"),fish.one(this).attr("attr-chiose",0)),f()}),fish.all(".pre_tc .pre_icon").hover(function(){fish.one(".pre_tcW").removeClass("none")},function(){fish.one(".pre_tcW").addClass("none")}),fish.one(".tehui").on("click",function(){fish.one("i",this).hasClass("none")?(fish.one("i",this).removeClass("none"),fish.one(this).attr("attr-chiose",1)):(fish.one("i",this).addClass("none"),fish.one(this).attr("attr-chiose",0)),f()}),fish.one(".cond_tab_filterbox").delegate("em","click",function(e){var s=fish.getTarget(e);fish.all("i",s).hasClass("none")?(fish.one("i",s).removeClass("none"),fish.one(s).attr("attr-chiose",1)):(fish.one("i",s).addClass("none"),fish.one(s).attr("attr-chiose",0)),"I"==s.tagName.toUpperCase()&&(fish.one(s).parent().attr("attr-chiose",0),fish.one(s).addClass("none")),fish.one(".hide_sale").removeClass("show"),f()});var O={};O.year=[],p(),fish.one("#bqContent").on("click",function(e){var s=fish.getTarget(e);do{var n=s.className;if(n&&n.indexOf("more")>-1){var t=fish.one(s);if(t.hasClass("up")){if(t.removeClass("up").addClass("down").html("收起<i></i>"),fish.one(".calendar",t.parent(".line_info")).removeClass("none"),""==fish.one(".calendar",t.parent(".line_info")).html()){var a=t.attr("_attr-id");_(t,a)}return}if(t.hasClass("down"))return t.removeClass("down").addClass("up").html("更多<i></i>"),void fish.one(".calendar",t.parent(".line_info")).addClass("none");break}if(n&&n.indexOf("mainLeft")>-1)break}while(s=s.parentNode)}),O.tmpl='<a class="dayjh" href="{dataHref}" target="{dataTarget}"><span class="date">{dateStr}</span><span class="dataprice">{priceStr}</span></a>',O.build=function(e,s,n,t,a){for(var o,i,l,r=s.getTime(),h=[],c=0,d=t.length-1;d>=c;c++){o=t[c];var f=Date.parse(o.LineDate.replace(/\-/gi,"/"));if(f>=r&&r+864e5>f){i=o;break}}i||(i={}),i.dateStr=n?n:s.getDate(),i.LineDate?(i.priceStr="&yen;"+i.MinPrice,i.dataHref=a.split(".html")[0]+"_"+t[c].LineDate+".html"+a.split(".html")[1],i.dataTarget="_blank"):(h.push("invalid-day"),i.dataHref="javascript:void(0);",i.dataTarget="_self"),l=this.tmpl.replace(/{(\w+)}/g,function(e,s){return i[s]||""}),e.innerHTML=l,fish.one(e).addClass(h.join(" "))},fish.browser("webkit")?fish.all("#active a").hover(function(){fish.one(".active_bg",this).anim("opacity: 1;",300)},function(){fish.one(".active_bg",this).anim("opacity: 0;",300)}):fish.browser("ms")&&fish.all("#active a").hover(function(){fish.one(".active_bg",this).anim("filter:alpha(opacity=50);",300)},function(){fish.one(".active_bg",this).anim("filter:alpha(opacity=0);",300)}),fish.one(".hot_search").on("click",function(){fish.one(".search_cont").removeClass("none")}),fish.one("body").on("click",function(e){var s=fish.getTarget(e);do{var n=s.className;if(n&&n.indexOf("hot_search")>-1)break;if(fish.dom("body")==s){fish.one(".search_cont").addClass("none");break}}while(s=s.parentNode)}),fish.all(".download_raiders",fish.one(".l_center")).on("click",function(){C()})}(),function(e){function s(e){var s={showCon:fish.one(""),shadowBg:fish.one(""),clickBgClose:!0,closeBut:fish.one(""),closeAfterFn:function(e,s){},showBeforeFn:function(e,s){}};fish.lang.extend(s,e);var n=s,t={show:function(){n.showBeforeFn(n.showCon,n.shadowBg),n.shadowBg.removeClass("none"),n.showCon.removeClass("none")},close:function(){n.shadowBg.addClass("none"),n.showCon.addClass("none"),n.closeAfterFn(n.showCon,n.shadowBg)}};return n.closeBut.on("click",function(){t.close()}),n.clickBgClose===!0&&n.shadowBg.on("click",function(){t.close()}),t}function n(e){if(!e||!e[0])return!1;var s=e.width(),n=e.height();e.css("position:fixed;left:50%;top:50%;marginLeft:"+-s/2+"px;marginTop:"+-n/2+"px;")}fish.admin.config({Calendar:{v:"0.3",css:"0.3",g:2015032101}});var t={init:function(){this.formConBox=s({showCon:fish.one(".tj_con_box"),shadowBg:fish.one(".tj_shadow"),closeBut:fish.one(".tj_con_box .s_close"),showBeforeFn:function(e,s){n(e)}}),this.msgForm=s({showCon:fish.one(".tj_alert_box"),shadowBg:fish.one(".tj_shadow"),closeBut:fish.one(".tj_alert_box .alert_close"),showBeforeFn:function(e,s){n(e)}}),this.cruiseObj.init(),this.tripDateObj.init(),this.codeObj.init(),this.bindEvent()},restAllInput:function(){for(var e=fish.all(".dl_tj_cos dl dd input"),s=0,n=e.length;n>s;s++){var t=fish.one(e[s]);t.attr("_placeholder")?t.addClass("place_holder").val(t.attr("_placeholder")):t.val("")}fish.one(".dl_tj_cos dl dd span.no_enter").removeClass("checked"),this.tripDateObj.noDateflag=!1,fish.all(".dl_tj_cos dl dd").removeClass("has_error"),this.codeObj.resetCode()},bindEvent:function(){var e=this,s=fish.one(".dl_tj_cos a.sub_data"),n=fish.all(".dl_tj_cos dl.eve_yusuan dd input,.dl_tj_cos dl.cust_name dd input,.dl_tj_cos dl.cust_mobile dd input,.dl_tj_cos dl.code dd input");this.inputObj.bindPlaceHolder(n),this.inputObj.filterKeyUp(fish.one(".dl_tj_cos dl.travel_num dd input"),"[^\\d]",3),this.inputObj.filterKeyUp(fish.one(".dl_tj_cos dl.eve_yusuan dd input"),"[^\\d]",13),s.on("click",function(){return s.hasClass("sub_no_act")?!1:void(e.subCheck()&&(s.addClass("sub_no_act").html("提交中..."),fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx",data:"action=SpecialReserOrder&"+e.getInputDataToStr(),openType:"post",type:"json",fn:function(n){if(s.removeClass("sub_no_act").html("提交"),!n)return e.alertMsgFn(0),!1;switch(n.ResultCode){case-100:t.msgCtrl.show(fish.dom(".dl_tj_cos dl.code dd input"),"验证码输入错误！");break;case 1:e.alertMsgFn(1),e.restAllInput();break;case 8:e.alertMsgFn(2),e.restAllInput();break;default:e.alertMsgFn(0)}}})))}),fish.one(".tj_alert_box .s_con").delegate(".close_but","click",function(){e.msgForm.close()}),fish.one(".l_box .but_tjyy").on("click",function(){var s=fish.dom(".ylc-nav .ylc-special-price");return s?(s.click(),e.statcClick(),!1):(e.cruiseObj.drawLine(),e.formConBox.show(),void e.statcClick())}),fish.all(".dl_tj_cos dl.cust_name dd input,.dl_tj_cos dl.cust_mobile dd input,.dl_tj_cos dl.code dd input").on("focus",function(){e.msgCtrl.close(this)})},inputObj:{bindPlaceHolder:function(e){return e&&e[0]?void e.on("focus",function(){var e=fish.one(this);thisVal=e.val(),thisPlaceHolder=e.attr("_placeholder"),thisVal==thisPlaceHolder&&e.hasClass("place_holder")&&e.val("").removeClass("place_holder")}).on("blur",function(){var e=fish.one(this);thisVal=e.val(),thisPlaceHolder=e.attr("_placeholder"),thisVal.length<=0&&e.val(thisPlaceHolder).addClass("place_holder")}):!1},filterKeyUp:function(e,s,n){if(!(e&&e[0]&&s&&n))return!1;var t=new RegExp(s,"g");e.on("keyup",function(){var e=fish.one(this),s=e.val().substr(0,n).replace(t,"");e.val(s)})}},msgCtrl:{show:function(e,s){return!e||!s||s.length<=0?!1:($parent=fish.one(e).parent("dd"),$parent.addClass("has_error"),void fish.one(".err_msg",$parent[0]).html("<i></i>"+s))},close:function(e){return e?($parent=fish.one(e).parent("dd"),$parent.removeClass("has_error"),void fish.one(".err_msg",$parent[0]).html("<i></i>")):!1}},cruiseObj:{init:function(){this.bindEvent()},bindEvent:function(){var e=fish.one(".dl_tj_cos dl.route_port  dd .s_line_con"),s=fish.one(".dl_tj_cos dl.route_port dd input");s.addClass("scon_tar_show"),s.on("click",function(){e.removeClass("none")}),e.addClass("scon_tar_show").delegate(".line_con_body .as_s","click",function(n){var t=fish.one(fish.getTarget(n));s.removeClass("place_holder").val(t.attr("_value")),e.addClass("none")}),fish.one(document).on("click",function(s){var n=fish.getTarget(s),t=fish.one(n),a=t.parent(".scon_tar_show");return t.hasClass("scon_tar_show")||a.length>=1?!0:void e.addClass("none")}),fish.one(".line_con_head .sps_close",e[0]).on("click",function(){e.addClass("none")})},drawLine:function(){return this.drawLineHasData?!1:(this.drawLineHasData=!0,void fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx?action=SearchRouteData",type:"json",fn:function(e){if(!e||!e[0])return!1;for(var s="",n=0,t=e.length;t>n;n++)s+='<span class="as_s" _value="'+e[n].CrName+'">'+e[n].CrName+"</span>";fish.one(".dl_tj_cos dl.route_port  dd .s_line_con .line_con_body").html(s)}}))}},tripDateObj:{init:function(){this.bindEvent(),this.noDateflag=!1},bindEvent:function(){var e=this,s=fish.one(".dl_tj_cos dl.tour_date dd input.input_start_date"),n=fish.one(".dl_tj_cos dl.tour_date dd input.input_end_date"),t=fish.one(""),a=fish.one("");fish.one(".dl_tj_cos dl dd span.no_enter").on("click",function(){var t=fish.one(this);t.hasClass("checked")?(t.removeClass("checked"),e.noDateflag=!1):(t.addClass("checked"),s.val(s.attr("_placeholder")).addClass("place_holder"),n.val(n.attr("_placeholder")).addClass("place_holder"),e.noDateflag=!0)}),fish.require("Calendar",function(){var o=new Date;o.setFullYear(o.getFullYear()+5),s.on("focus",function(i){if(e.noDateflag)return!1;t.html("remove");var l=new fish.Calendar({skin:"white",style:"show",wrapper:fish.all(".dl_tj_cos dl.tour_date dd .s_show_div")[0],elem:this,startDate:new Date,endDate:n.val()&&n.val()!=n.attr("_placeholder")?new Date(new Date(n.val().replace(/-/g,"/")).getTime()-864e5):o,fn:function(i,l,r,h,c){t.addClass("none"),s.removeClass("place_holder"),n.removeClass("place_holder");var d=new Date(i+"/"+l+"/"+r).getTime()+864e5;a.html("remove");var f=new fish.Calendar({skin:"white",style:"show",wrapper:fish.all(".dl_tj_cos dl.tour_date dd .s_show_div")[1],startDate:new Date(d),endDate:o,elem:n[0],currentDate:[new Date(d)],fn:function(e,s,n,t,o){a.addClass("none")}});a=fish.one(f.panel),a.parent(".s_show_div").addClass("tar_cal_jenvent"),a.css("position:absolute;top:30px;left:0;z-index:2;"),e.setCalPosition(a)}});t=fish.one(l.panel),t.parent(".s_show_div").addClass("tar_cal_jenvent"),t.css("position:absolute;top:30px;left:0;z-index:2;"),e.setCalPosition(t)}),n.on("focus",function(t){if(e.noDateflag)return!1;var i=s.val()&&s.val()!=s.attr("_placeholder")?new Date(new Date(s.val().replace(/-/g,"/")).getTime()+864e5):new Date((new Date).getTime()+864e5);a.html("remove");var l=new fish.Calendar({skin:"white",style:"show",wrapper:fish.all(".dl_tj_cos dl.tour_date dd .s_show_div")[1],elem:this,startDate:i,endDate:o,fn:function(e,s,t,o,i){n.removeClass("place_holder"),a.addClass("none")}});a=fish.one(l.panel),a.parent(".s_show_div").addClass("tar_cal_jenvent"),a.css("position:absolute;top:30px;left:0;z-index:2;"),e.setCalPosition(a)})}),fish.one(document).on("click",function(e){var s=fish.one(fish.getTarget(e)),n=s.parent(".tar_cal_jenvent");return s.hasClass("tar_cal_jenvent")||n.length>=1?!1:(t.addClass("none"),void a.addClass("none"))}),s.on("click",function(e){a.addClass("none")}),n.on("click",function(e){t.addClass("none")})},setCalPosition:function(e){var s=e.parent(".tj_con_box"),n=fish.one(window).width(),t=s.width(),a=e.width(),o=e.offset().left+a-s.offset().left-t,i=(n-t)/2-o;0>i&&e.css("left:"+i+"px;")}},calCreateFn:function(e){},codeObj:{init:function(){this.getCodeFlag=!0,this.bindEvent()},bindEvent:function(){var e=this;fish.one(".dl_tj_cos dl.code dd span.get_code").on("click",function(){t.checkObj.checkPhone()&&e.getCodeFlag===!0&&(e.getCode(),e.timerCode(6e4))})},getCode:function(){fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx",data:"action=GetSmsAuthCode&custMobile="+fish.one(".dl_tj_cos dl.cust_mobile dd input").val(),fn:function(){}})},timerCode:function(e){var s=this,n=fish.one(".dl_tj_cos dl.code dd span.get_code"),t=fish.one("span i",n[0]),a=e||3e4,o=500;this.timerD=setInterval(function(){0>=a&&(s.getCodeFlag=!0,n.removeClass("no_active"),clearInterval(timerD)),t.html(Math.round(a/1e3)),a-=o},o),t.html(Math.round(a/1e3)),this.getCodeFlag=!1,n.addClass("no_active")},resetCode:function(){var e=fish.one(".dl_tj_cos dl.code dd span.get_code"),s=fish.one("span i",e[0]);this.getCodeFlag=!0,e.removeClass("no_active"),s.html("0"),this.timerD&&clearInterval(this.timerD)}},subCheck:function(){return this.checkObj.checkName()&this.checkObj.checkPhone()&this.checkObj.checkCode()},checkObj:{checkName:function(){var e=fish.one(".dl_tj_cos dl.cust_name dd input"),s=/^[^@\/\'\\\"#$%&\^\*\(!\^\*\;\:\>\<\-\|]+$/,n=fish.trim(e.val()),a=fish.trim(e.attr("_placeholder"));return n=e.hasClass("place_holder")&&n==a?"":n,n.length<=0?(t.msgCtrl.show(e[0],"请填写联系人姓名！"),!1):s.test(n)?(t.msgCtrl.close(e[0]),!0):(t.msgCtrl.show(e[0],"姓名中包含非法字符！"),!1)},checkPhone:function(){var e=fish.one(".dl_tj_cos dl.cust_mobile dd input"),s=/^(13[0-9]|15[0-9]|17[0-9]|18[0-9]|147)\d{8}$/,n=fish.trim(e.val()),a=fish.trim(e.attr("_placeholder"));return n=e.hasClass("place_holder")&&n==a?"":n,n.length<=0?(t.msgCtrl.show(e[0],"请输入手机号！"),!1):s.test(n)?(t.msgCtrl.close(e[0]),!0):(t.msgCtrl.show(e[0],"请输入正确的手机号！"),!1)},checkCode:function(){var e=fish.one(".dl_tj_cos dl.code dd input"),s=fish.trim(e.val()),n=fish.trim(e.attr("_placeholder"));return s=e.hasClass("place_holder")&&s==n?"":s,s.length<=0?(t.msgCtrl.show(e[0],"请输入验证码！"),!1):(t.msgCtrl.close(e[0]),!0)}},getInputDataToStr:function(){for(var e=fish.all(".dl_tj_cos input"),s="",n=0,t=e.length;t>n;n++){var a=fish.one(e[n]),o=a.attr("_placeholder"),i=a.hasClass("place_holder")&&a.val()==o?"":a.val(),l=a.attr("name");s+="&"+l+"="+encodeURIComponent(i)}return s.substr(1)},alertMsgFn:function(e){var s="";switch(e){case 2:s='<h4 class="h4_txt">亲~您已经提交过哦</h4>					        <p class="ps">客服将尽快联系您<br/>请不要拒接0512开头的电话</p>					        <span class="msg_dbg success_sbg"></span>					        <span class="close_but">关闭</span>';break;case 0:s='<h4 class="h4_txt">提交失败！</h4>					        <span class="msg_dbg fail_sbg"></span>					        <span class="close_but">关闭</span>';break;case 1:s='<h4 class="h4_txt">通知预约成功！</h4>					        <p class="ps">客服将尽快联系您<br/>请不要拒接0512开头的电话</p>					        <span class="msg_dbg success_sbg"></span>					        <span class="close_but">关闭</span>'}s.length>=0&&(fish.one(".tj_alert_box .s_con").html(s),this.formConBox.close(),this.msgForm.show())},statcClick:function(){var e=fish.one("#hidIsFinalPage").val();fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx?action=SpecialReserClick&isFinal="+e,fn:function(){}})}};fish.one(document).ready(function(){t.init()})}(window),function(e){function s(e,s){if(s.k&&(s.k=decodeURIComponent(s.k)),s.ct&&(s.ct=decodeURIComponent(s.ct)),!e||!e.trim())return!1;var n="";for(key in s)null!==s[key]&&void 0!==s[key]&&""!==s[key]&&(n+="|*|"+key+":"+s[key]);try{n.length>0&&(n+="|*|"),_tcTraObj._tcTrackEvent("search","/cruises/list",e,n)}catch(t){}}function n(e){var n={type:1,lable:"",value:{}};fish.lang.extend(n,e);var t=n.lable.replace(/\//g,"_");1==n.type?fish.cookie.set(t,1):2==n.type&&1==fish.cookie.get(t)&&(fish.cookie.remove(t),s(n.lable,n.value))}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},fish.all(".hotSearch a").each(function(e,n){this.index=n,fish.one(e).on("click",function(e){var n=this;$this=fish.one(this),s("/sbox/k/hot",{k:encodeURIComponent($this.html()),pos:n.index+1,jpTp:1})})}),fish.all(".hotword a").each(function(e,n){this.index=n,fish.one(e).on("click",function(e){var n=this;$this=fish.one(this),s("/sbox/k/hot",{k:encodeURIComponent($this.html()),pos:n.index+1,jpTp:1})})}),fish.one("body").delegate(".cond_tab_filterbox .tehui,.cond_tab_filterbox .pre_tc,#baochuan,.cond_tab_conbox dd a,.allSearchList a,.condition_box .scut_sty .link_sty","click",function(e){n({lable:"/filter"})}),fish.one("body").delegate(".line_info a.linebtn,.line_info .tit a","click",function(e){var t=e.target,a=fish.one(t).parent(".line_info");s("/detail",{k:encodeURIComponent(fish.one(".searchConditonLab").attr("data-dest")),pjId:"2007",resId:a.attr("_lineId")}),n({lable:"/show"})}),e.searchTrackEvent=s,e.trackEventUseCookie=n}(window);