fish.admin.config({Calendar:{v:"0.3",css:"0.3",g:2015032101},anim:{v:"0.3",g:2016061704}});var ylcNavObj=ylcNavObj||{};!function(e,t,n,l){function a(e){return e=parseInt(e,10),isNaN(e)?0:0>e?0:e}e.lang.extend(ylcNavObj,{init:function(){var l=this;setTimeout(function(){l.specReserTips.init.call(l.specReserTips)},3e3),o.changePic(),e.one(".ylc-nav .ylc-item").once("ylcNavObj",function(){e.one(this).on("click",function(){e.ajax({url:"/youlun/AjaxCall_Cruise.aspx?Type=CruiseHomePageWindowStatistic&value=ActivityClick"})})}),e.one(".ylc-nav .ylc-gotop").once("ylcNavObj",function(){e.one(this).on("click",function(){e.dom("body").scrollTop=0,e.dom("html").scrollTop=0})});var a=function(){e.one(this).scrollTop()>50?e.one(".ylc-nav .ylc-gotop").css("visibility: visible;"):e.one(".ylc-nav .ylc-gotop").css("visibility: hidden;")};e.one(t).once("ylcNavObj",function(){e.one(t).on("scroll",a),a()}),e.one(".ylc-nav .ylc-plus .ylc-plus-close").once("ylcNavObj",function(){e.one(this).on("click",function(){var t=(e.one(this),e.one(".ylc-nav .ylc-plus")),n=fish.browser();"ms"==n.name&&n.version<10?t.html("remove"):(t.removeClass("fadeInDown").addClass("fadeInUp"),setTimeout(function(){t.html("remove")},1600))})}),e.one(".ylc-nav .ylc-plus .ylc-plus-cont").once("ylcNavObj",function(){e.one(this).on("click",function(){var t=(e.one(this),e.one(".ylc-nav .ylc-plus .ylc-plus-tips"));t.length&&t.css({display:"block"}),e.ajax({url:"/youlun/AjaxCall_Cruise.aspx?Type=CruiseDetailPageWindowStatistic&value=DiscountClick"})})}),e.one(n).once("ylcNavObj",function(){e.one(this).on("click",function(t){var n=e.one(fish.getTarget(t)),l=n.parent(".ylc-plus");n.hasClass("ylc-plus")||l.length>0||e.one(".ylc-nav .ylc-plus .ylc-plus-tips").length&&e.one(".ylc-nav .ylc-plus .ylc-plus-tips").css({display:"none"})})})},specReserDialog:{init:function(){},bindEvent:function(){},isFinal:function(){var t=e.one("#hidIsFinalPage"),n=e.one("#hidFinalLineId"),l=e.one("#hidTjBeginDate");return t&&t[0]&&a(t.val())&&n&&n[0]&&a(n.val())&&l&&l[0]&&e.trim(l.val()).length>0}},specReserTips:{poll:function(){var t=this;return this.tipTimer&&clearInterval(this.tipTimer),this.hideTimer&&(clearTimeout(this.hideTimer),e.one(".ylc-nav .ylc-tips").removeClass("open")),this.DATA&&this.DATA.length?(this.show(),this.hideTimer=setTimeout(function(){e.one(".ylc-nav .ylc-tips").removeClass("open")},3e3),void(this.tipTimer=setInterval(function(){var n=a(e.one(".ylc-modal-tips p").attr("t-attr"));e.one(".ylc-modal-tips p").anim("top:"+(0-n-22)+"px",600,function(){var n=a(e.one(".ylc-modal-tips p").attr("t-attr"));n>=22*t.DATA.length&&(e.one(".ylc-modal-tips p").css({top:"0px"}),e.one(".ylc-modal-tips p").attr("t-attr",0))}),e.one(".ylc-modal-tips p").attr("t-attr",n+22)},4200))):!1},show:function(){if(!this.DATA||!this.DATA.length)return!1;var t=e.all(".ylc-nav .ylc-tips"),n=e.all(".ylc-modal-tips"),l="{0}成功预约{1}人出游",a="";sytObj.forEach(this.DATA,function(e,t){a+=("<span>"+l+"</span>").format(t.Mobile||"",t.PersonNum||"")}),a+=("<span>"+l+"</span>").format(this.DATA[0].Mobile||"",this.DATA[0].PersonNum||""),t.html(l.format(this.DATA[0].Mobile||"",this.DATA[0].PersonNum||"")),e.one("p",n).html(a),e.one("p",n).attr("t-attr",0),e.one("p",n).css({top:"0"}),t.addClass("open"),n.addClass("open")},hide:function(){var t=e.all(".ylc-nav .ylc-tips,.ylc-modal-tips");t.removeClass("open")},load:function(){var t=this;this.loadTimer&&clearTimeout(this.loadTimer),e.ajax({url:"/youlun/cruiserequireorder/homepageRequireorder.ashx?action=GetRequireOrder&top=10",type:"json",fn:function(e){e&&e.length&&e[0]&&"object"==typeof e&&(t.DATA=e,t.poll.call(t)),t.loadTimer=setTimeout(function(){t.load.call(t)},18e4)}})},init:function(){this.load()}}});var s=s||{};e.lang.extend(s,{init:function(){ylcNavObj.specReserDialog.isFinal()?(o.setDialogTitle(),e.all(".ylc-m-title").removeClass("none"),e.all(".ylc-m-time").addClass("none")):(e.all(".ylc-m-title").addClass("none"),e.all(".ylc-m-time").removeClass("none")),this.formConBox=s.alertFormCtrl({showCon:fish.one(".ylc-modal"),shadowBg:fish.one(".ylc-modal-layer"),closeBut:fish.one(".ylc-modal .ylc-modal-head a"),showBeforeFn:function(e,t){s.cirCenter(e)}}),this.msgForm=s.alertFormCtrl({showCon:fish.one(".ylc-modal-rs"),shadowBg:fish.one(".ylc-modal-layer"),closeBut:fish.one(".ylc-modal-rs .ylc-mr-close"),showBeforeFn:function(e,t){s.cirCenter(e)}}),this.cruiseObj.init(),this.tripDateObj.init(),this.codeObj.init(),this.bindEvent()},restAllInput:function(){for(var e=fish.all(".ylc-modal dl dd input"),t=0,n=e.length;n>t;t++){var l=fish.one(e[t]);l.attr("_placeholder")?l.addClass("place_holder").val(l.attr("_placeholder")):l.val("")}fish.one(".ylc-modal dl dd span.no_enter").removeClass("checked"),this.tripDateObj.noDateflag=!1,fish.all(".ylc-modal dl dd").removeClass("has_error"),this.codeObj.resetCode()},bindEvent:function(){var e=this,t=fish.one(".ylc-modal .ylc-modal-foot a.sub_data"),n=fish.all(".ylc-modal dl.eve_yusuan dd input,.ylc-modal dl.cust_name dd input,.ylc-modal dl.cust_mobile dd input,.ylc-modal dl.code dd input");this.inputObj.bindPlaceHolder(n),this.inputObj.filterKeyUp(fish.all(".ylc-modal dl.travel_num dd input"),"[^\\d]",3),this.inputObj.filterKeyUp(fish.one(".ylc-modal dl.eve_yusuan dd input"),"[^\\d]",13),t.on("click",function(){return t.hasClass("sub_no_act")?!1:void(e.subCheck()&&(t.addClass("sub_no_act").html("提交中..."),fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx",data:"action=SpecialReserOrder&"+e.getInputDataToStr(),openType:"post",type:"json",fn:function(n){if(t.removeClass("sub_no_act").html("提交"),!n)return e.alertMsgFn(0),!1;switch(n.ResultCode){case-100:s.msgCtrl.show(fish.dom(".ylc-modal dl.code dd input"),"验证码输入错误！");break;case 1:e.alertMsgFn(1),e.restAllInput();break;case 8:e.alertMsgFn(2),e.restAllInput();break;default:e.alertMsgFn(0)}}})))}),fish.one(".ylc-modal-rs .s_con").delegate(".close_but","click",function(){e.msgForm.close()}),fish.one(".ylc-nav .ylc-special-price").on("click",function(){e.cruiseObj.drawLine(),e.formConBox.show(),e.statcClick(),o.setDialogTitle()}),fish.all(".ylc-modal dl.cust_name dd input,.ylc-modal dl.cust_mobile dd input,.ylc-modal dl.code dd input").on("focus",function(){e.msgCtrl.close(this)})},inputObj:{bindPlaceHolder:function(e){return e&&e[0]?void e.on("focus",function(){var e=fish.one(this);thisVal=e.val(),thisPlaceHolder=e.attr("_placeholder"),thisVal==thisPlaceHolder&&e.hasClass("place_holder")&&e.val("").removeClass("place_holder")}).on("blur",function(){var e=fish.one(this);thisVal=e.val(),thisPlaceHolder=e.attr("_placeholder"),thisVal.length<=0&&e.val(thisPlaceHolder).addClass("place_holder")}):!1},filterKeyUp:function(e,t,n){if(!(e&&e[0]&&t&&n))return!1;var l=new RegExp(t,"g");e.on("keyup",function(){var e=fish.one(this),t=e.val().substr(0,n).replace(l,"");e.val(t)})}},msgCtrl:{show:function(e,t){return!e||!t||t.length<=0?!1:($parent=fish.one(e).parent("dd"),$parent.addClass("has_error"),void fish.one(".err_msg",$parent[0]).html("<i></i>"+t))},close:function(e){return e?($parent=fish.one(e).parent("dd"),$parent.removeClass("has_error"),void fish.one(".err_msg",$parent[0]).html("<i></i>")):!1}},cruiseObj:{init:function(){this.bindEvent()},bindEvent:function(){var t=fish.one(".ylc-modal .ylc-sltport"),l=fish.one(".ylc-modal dl.route_port dd input");l.addClass("scon_tar_show"),l.on("click",function(){var n=e.one(this).offset().left,l=e.one(this).offset().top+30;n-=e.one(".ylc-modal").offset().left,l-=e.one(".ylc-modal").offset().top,t.css("display:block;top:"+l+"px;left:"+n+"px;")}),t.addClass("scon_tar_show").delegate(".ylc-sltport-content a","click",function(e){var n=fish.one(fish.getTarget(e));l.removeClass("place_holder").val(n.attr("attr-val")),t.css({display:"none"})}),fish.one(n).on("click",function(e){var n=fish.getTarget(e),l=fish.one(n),a=l.parent(".scon_tar_show");return l.hasClass("scon_tar_show")||a.length>=1?!0:void t.css({display:"none"})}),fish.one(".ylc-sltport-close",t[0]).on("click",function(){t.css({display:"none"})})},drawLine:function(){return this.drawLineHasData?!1:(this.drawLineHasData=!0,void fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx?action=SearchRouteData",type:"json",fn:function(e){if(!e||!e[0])return!1;for(var t="",n=0,l=e.length;l>n;n++)t+="<a class='{0}' href='javascript:;' {2} attr-val='{1}'>{1}</a>".format("",fish.trim(e[n].CrName||""),"");fish.all(".ylc-modal .ylc-sltport-body").html("<div class='ylc-sltport-content '>"+t+"</div>")}}))}},tripDateObj:{init:function(){this.bindEvent(),this.noDateflag=!1},bindEvent:function(){var e=this,t=fish.one(".ylc-modal dl.tour_date dd input.input_start_date"),l=fish.one(".ylc-modal dl.tour_date dd input.input_end_date"),a=fish.one(""),s=fish.one("");fish.one(".ylc-modal dl dd span.no_enter").on("click",function(){var n=fish.one(this);n.hasClass("checked")?(n.removeClass("checked"),e.noDateflag=!1):(n.addClass("checked"),t.val(t.attr("_placeholder")).addClass("place_holder"),l.val(l.attr("_placeholder")).addClass("place_holder"),e.noDateflag=!0)}),fish.require("Calendar",function(){var n=new Date;n.setFullYear(n.getFullYear()+5),t.on("focus",function(o){if(e.noDateflag)return!1;a.html("remove");var i=new fish.Calendar({skin:"white",style:"show",wrapper:fish.all(".ylc-modal dl.tour_date dd .s_show_div")[0],elem:this,startDate:new Date,endDate:l.val()&&l.val()!=l.attr("_placeholder")?new Date(new Date(l.val().replace(/-/g,"/")).getTime()-864e5):n,fn:function(o,i,c,r,d){a.addClass("none"),t.removeClass("place_holder"),l.removeClass("place_holder");var h=new Date(o+"/"+i+"/"+c).getTime()+864e5;s.html("remove");var u=new fish.Calendar({skin:"white",style:"show",wrapper:fish.all(".ylc-modal dl.tour_date dd .s_show_div")[1],startDate:new Date(h),endDate:n,elem:l[0],currentDate:[new Date(h)],fn:function(e,t,n,l,a){s.addClass("none")}});s=fish.one(u.panel),s.parent(".s_show_div").addClass("tar_cal_jenvent"),s.css("position:absolute;top:30px;left:0;z-index:2;"),e.setCalPosition(s)}});a=fish.one(i.panel),a.parent(".s_show_div").addClass("tar_cal_jenvent"),a.css("position:absolute;top:36px;left:0;z-index:2;"),e.setCalPosition(a)}),l.on("focus",function(a){if(e.noDateflag)return!1;var o=t.val()&&t.val()!=t.attr("_placeholder")?new Date(new Date(t.val().replace(/-/g,"/")).getTime()+864e5):new Date((new Date).getTime()+864e5);s.html("remove");var i=new fish.Calendar({skin:"white",style:"show",wrapper:fish.all(".ylc-modal dl.tour_date dd .s_show_div")[1],elem:this,startDate:o,endDate:n,fn:function(e,t,n,a,o){l.removeClass("place_holder"),s.addClass("none")}});s=fish.one(i.panel),s.parent(".s_show_div").addClass("tar_cal_jenvent"),s.css("position:absolute;top:36px;left:0;z-index:2;"),e.setCalPosition(s)})}),fish.one(n).on("click",function(e){var t=fish.one(fish.getTarget(e)),n=t.parent(".tar_cal_jenvent");return t.hasClass("tar_cal_jenvent")||n.length>=1?!1:(a.addClass("none"),void s.addClass("none"))}),t.on("click",function(e){s.addClass("none")}),l.on("click",function(e){a.addClass("none")})},setCalPosition:function(e){var n=e.parent(".ylc-modal"),l=fish.one(t).width(),a=n.width(),s=e.width(),o=e.offset().left+s-n.offset().left-a,i=(l-a)/2-o;0>i&&e.css("left:"+i+"px;")}},calCreateFn:function(e){},codeObj:{init:function(){this.getCodeFlag=!0,this.bindEvent()},bindEvent:function(){var e=this;fish.one(".ylc-modal dl.code dd span.get_code").on("click",function(){s.checkObj.checkPhone()&&e.getCodeFlag===!0&&(e.getCode(),e.timerCode(6e4))})},getCode:function(){fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx",data:"action=GetSmsAuthCode&custMobile="+fish.one(".ylc-modal dl.cust_mobile dd input").val(),fn:function(){}})},timerCode:function(e){var t=this,n=fish.one(".ylc-modal dl.code dd span.get_code"),l=fish.one("span i",n[0]),a=e||3e4,s=500;this.timerD=setInterval(function(){0>=a&&(t.getCodeFlag=!0,n.removeClass("no_active"),clearInterval(t.timerD)),l.html(Math.round(a/1e3)),a-=s},s),l.html(Math.round(a/1e3)),this.getCodeFlag=!1,n.addClass("no_active")},resetCode:function(){var e=fish.one(".ylc-modal dl.code dd span.get_code"),t=fish.one("span i",e[0]);this.getCodeFlag=!0,e.removeClass("no_active"),t.html("0"),this.timerD&&clearInterval(this.timerD)}},subCheck:function(){return this.checkObj.checkName()&this.checkObj.checkPhone()&this.checkObj.checkCode()},checkObj:{checkName:function(){var e=fish.one(".ylc-modal dl.cust_name dd input"),t=/^[^@\/\'\\\"#$%&\^\*\(!\^\*\;\:\>\<\-\|]+$/,n=fish.trim(e.val()),l=fish.trim(e.attr("_placeholder"));return n=e.hasClass("place_holder")&&n==l?"":n,n.length<=0?(s.msgCtrl.show(e[0],"请填写联系人姓名！"),!1):t.test(n)?(s.msgCtrl.close(e[0]),!0):(s.msgCtrl.show(e[0],"姓名中包含非法字符！"),!1)},checkPhone:function(){var e=fish.one(".ylc-modal dl.cust_mobile dd input"),t=/^(13[0-9]|15[0-9]|17[0-9]|18[0-9]|147)\d{8}$/,n=fish.trim(e.val()),l=fish.trim(e.attr("_placeholder"));return n=e.hasClass("place_holder")&&n==l?"":n,n.length<=0?(s.msgCtrl.show(e[0],"请输入手机号！"),!1):t.test(n)?(s.msgCtrl.close(e[0]),!0):(s.msgCtrl.show(e[0],"请输入正确的手机号！"),!1)},checkCode:function(){var e=fish.one(".ylc-modal dl.code dd input"),t=fish.trim(e.val()),n=fish.trim(e.attr("_placeholder"));return t=e.hasClass("place_holder")&&t==n?"":t,t.length<=0?(s.msgCtrl.show(e[0],"请输入验证码！"),!1):(s.msgCtrl.close(e[0]),!0)}},getInputDataToStr:function(){var t,n="";t=ylcNavObj.specReserDialog.isFinal()?e.all("#hidIsFinalPage,#hidFinalLineId,#hidTjBeginDate,.ylc-m-title .eve_yusuan input,.ylc-m-title .travel_num input,.cust_name input,.cust_mobile input,.code input",e.one(".ylc-modal")):e.all(".ylc-m-time .route_port input,.ylc-m-time .travel_num input,.ylc-m-time .tour_date input,.cust_name input,.cust_mobile input,.code input",e.one(".ylc-modal"));for(var l=0,a=t.length;a>l;l++){var s=fish.one(t[l]),o=s.attr("_placeholder"),i=s.hasClass("place_holder")&&s.val()==o?"":s.val(),c=s.attr("name");n+="&"+c+"="+encodeURIComponent(i)}return n.substr(1)},alertMsgFn:function(e){var t="";switch(e){case 2:t='<h4 class="h4_txt">亲~您已经提交过哦</h4>                            <p class="ps">客服将尽快联系您<br/>请不要拒接0512开头的电话</p>                            <span class="msg_dbg success_sbg"></span>                            <span class="close_but">关闭</span>';break;case 0:t='<h4 class="h4_txt">提交失败！</h4>                            <span class="msg_dbg fail_sbg"></span>                            <span class="close_but">关闭</span>';break;case 1:t='<h4 class="h4_txt">通知预约成功！</h4>                            <p class="ps">客服将尽快联系您<br/>请不要拒接0512开头的电话</p>                            <span class="msg_dbg success_sbg"></span>                            <span class="close_but">关闭</span>'}t.length>=0&&(fish.one(".ylc-modal-rs .s_con").html(t),this.formConBox.close(),this.msgForm.show())},statcClick:function(){var e=fish.one("#hidIsFinalPage").val();fish.ajax({url:"/youlun/CruiseRequireOrder/HomePageRequireOrder.ashx?action=SpecialReserClick&isFinal="+e,fn:function(){}})},alertFormCtrl:function(e){var t={showCon:fish.one(""),shadowBg:fish.one(""),clickBgClose:!0,closeBut:fish.one(""),closeAfterFn:function(e,t){},showBeforeFn:function(e,t){}};fish.lang.extend(t,e);var n=t,l={show:function(){n.showBeforeFn(n.showCon,n.shadowBg),n.shadowBg.removeClass("none"),n.showCon.removeClass("none")},close:function(){n.shadowBg.addClass("none"),n.showCon.addClass("none"),n.closeAfterFn(n.showCon,n.shadowBg)}};return n.closeBut.on("click",function(){l.close()}),n.clickBgClose===!0&&n.shadowBg.on("click",function(){l.close()}),l},cirCenter:function(e){if(!e||!e[0])return!1;var t=e.width(),n=e.height();e.css("position:fixed;left:50%;top:50%;marginLeft:"+-t/2+"px;marginTop:"+-n/2+"px;")}});var o=o||{};e.lang.extend(o,{changePic:function(){var t=e.one(".ylc-nav .ylc-item");this.isDuring("2016-06-02","2016-06-17")&&(e.one("img",t).attr("src","http://img1.40017.cn/cn/y/16/h/ylnav616-top.jpg"),e.one(".ylc-more img",t).attr("src","http://img1.40017.cn/cn/y/16/h/cruisesale616.jpg")),this.isDuring("2016-06-20","2017-06-20")&&(e.one("img",t).attr("src","http://img1.40017.cn/cn/y/16/c/ylnav-top-1.jpg"),e.one(".ylc-more img",t).attr("src","http://img1.40017.cn/cn/y/16/c/cruisesale-1.jpg")),e.ajax({url:"/youlun/cruiseactivity/TopicActivityAjax.aspx?Type=GetTodayHotLine&specialId=330&moduleId=911",type:"json",fn:function(n){if(n.stlSortNo>0){var l=e.one("img",t),a=e.one("script",t),s=e.one(".ylc-more",t);l.attr("src",l.attr("src-attr")),s.html(a.html().format(n.image,n.stlRecommend,parseInt(n.price,10))),t.attr("href",n.url||"javascript:;")}}})},isDuring:function(t,n){var l=e.parseDate().getTime(),t=e.parseDate(t).getTime(),n=e.parseDate(n).getTime();return l>=t&&n>=l},setDialogTitle:function(){if(ylcNavObj.specReserDialog.isFinal()){var t=e.create("<div></div>");t.html(e.one(".pro_tit .h2_title").html()),e.all("*",t).html("remove"),t=e.trim(t.html()),t&&t.length||(t=e.trim(e.one(".content .location .h2_local").html())),t&&t.length||(t="邮轮特价预约线路"),e.one(".ylc-modal .ylc-m-title .route-tit").html(t)}}}),fish.ready(function(){ylcNavObj.init(),s.init();var t=e.one("#onlineSellPriceDefault");e.dom(t)&&(t=t.val(),t=parseInt(t,10),t=isNaN(t)?0:0>t?0:t,t>=50&&e.one(".ylc-nav .ylc-plus").css({display:"block"}).addClass("fadeInDown"))})}(fish,window,window.document);